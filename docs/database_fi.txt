Dokumentaatio tietokannoista

==========
= Taulut =
==========

=== t_customers ===
* Taulu sisältää tiedon asiakkaista/jäsenistä
** rivi per asiakas
* Asiakkailla on nimi (yrityksen tai henkilö nimi)
* Asiakkaaseen kuuluu yksi tai useampi käyttäjä

=== t_aliases ===
* Taulu sisältää tiedon asiakkaiden globaalin nimiavaruuden aliaksista
* Aliaksia käytetään, kun asiakas tarvitsee globaalin nimiavaruuden palveluita (mysql,shell yms)
  muulla, kuin omalla käyttäjänimellään varustettuna.

=== t_users ===
* Jokaisella asiakkaalla voi olla useampi käyttäjä
* Käyttäjä voi olla virtuaalinen käyttäjä tai liitetty johonkin 
  unix tunnukseen unix_id:n avulla.
* Domain kertoo, mihin domainiin käyttäjä liittyy
** Domain määrittelee, mitä palveluita käyttäjälle voi asettaa.

=== t_domains ===
* Taulu sisältää tiedon käyttäjien domainista.

== Kentät ==
* name (text) Domainin nimi, kuten kapsi.fi
* shared (bool) Kertoo onko domain jaettu, kertoo voiko domainia käyttää 
  muutkin asiakkaat, kuin domainin omistaja
* t_customers_id (integer) viittaus t_customers taulussa olevaan domainin omistajaan
* dns (bool) kertoo liittyykö domainiin dns-tietueita
* created (timestamptz) milloin domain on lisätty
* updated (timestamptz) milloin domainia on päivitetty
* refresh_time (integer) SOA tietue
* retry_time (integer) SOA tietue
* expire_time (integer) SOA tietue
* minimum_cache_time (integer) SOA tietue
* ttl (integer) SOA tietue
* admin_address (text) hostmasterin sähköpostiosoite
* domain_type (MASTER|SLAVE|NONE), onko tämä nimipalvelin ensi- vai toissijainen
* masters text[] lista domainin master-palvelimista
* allow_transfer text[] mitkä palvelimet saavat hakea domainin tältä palvelimelta.

=== t_vhosts ===
* taulu, johon aliakset referoi
* sisältää tiedot vhostin omistajasta
* referoi domainiin
* dns-tietueet lisätään, päivitetään ja poistetaan automaattisesti

== Kentät ==
* t_vhosts_id Vhost-tietueen uniikki id
* t_users_id viittaus t_users taulussa olevaan käyttäjään
* parent_id jos tämä rivi on alias tai redirect, viittaus parent riviin
* t_services_id viittaus t_services taulussa olevaan vhost-palvelimeen, mikä palvelee tämän  vhostin
** Käytetään dns-tietueen luomiseen
* name text not null,
* created timestamptz default now(),
* t_domains_id integer not null REFERENCES t_domains,
* is_redirect boolean default false not null,
* logaccess boolean default false not null,
* redirect_to text default null,
* locked boolean default false not null,
* disabled boolean DEFAULT FALSE NOT NULL,
* document_root text,t_users_id integer REFERENCES t_users NOT NULL,
parent_id integer REFERENCES t_vhosts,
t_services_id integer REFERENCES t_services,
name text not null,
created timestamptz default now(),
t_domains_id integer not null REFERENCES t_domains,
is_redirect boolean default false not null,
logaccess boolean default false not null,
redirect_to text default null,
locked boolean default false not null,
disabled boolean DEFAULT FALSE NOT NULL,
document_root text,


=== t_hosts ===
* Sisältää tiedon palvelimista

== Kentät ==
* name (text) palvelimen nimi
* type (HARDWARE|VIRTUAL) onko palvelin virtuaalinen vai fyysinen rauta
* t_domains_id (integer) viittaus t_domains taulussa olevaan domainiin, johon tämä palvelin kuuluu
* t_customers_id (integer) viittaus t_customers tauluun, jossa tämän palvelimen omistaja on

=== t_subnets ===
* name (text) verkon nimi
* location (text) Verkon fyysinen sijainti
* info (text) lisätietoa verkosta
* vlan_tag (integer) tägätyn vlanin numero, fyysisellä verkolla nolla
* address (inet) osoiteavaruus esim. 10.0.1.0/24
* gateway (inet) verkon oletusgateway
* dns_servers (inet[]) mitä nimipalvelimia tässä verkossa tulee käyttää
* dhcp_range (inet) Mitkä osoitteet on varattu dhcp:lle
* dhcp_options (text) mahdolliset optiot dhcp:lle
* mtu (integer) verkon mtu, oletuksena 1500
* hostmaster_address (text) verkon vastaavan sähköpostiosoite (dns tietuetta varten)

=== t_user_ports ===
* Taulu, joka sisältää tiedon käyttäjien avoimista porteista shell-palvelimilla
* portit väliltä 40000 - 65536
* portti valitaan automaattisesti

=== t_change_log ===
* Taulu, joka sisältää tiedot tietokantaan tehdyistä muutoksista


=== t_services ===
* Taulu sisältää tiedon rengin piirissä olevista palveluista

== Kentät ==
* t_services_id uniikki id
* t_addresses_id viittaus t_addresses taulussa olevaan osoitteeseen.
* t_v6addresses_id viittaus t_addresses taulussa olevaan ipv6-osoitteeseen
* service_type viittaus t_service_types taulussa olevaan palvelun tyyppiin
* t_domains_id viittaus t_domains tauluun, rajottaa käyttöoikeuden vain saman
               domainin piiriin
* info vapaa tekstikenttä
* active totuusarvo onko palveli käytössä
* public totuusarvo näytetäänkö palvelu palvelulistauksessa, useamman palvelimen
         käsittävissä palveluissa vain master on public
* priority palvelun prioriteetti, jos palvelu käsittää useamman palvelun,
           masterin prioriteetti on 1 ja muiden 2 tai enemmän.

==========
= Viewit =
==========

=== vhosts ===
* viewi mitä käyttäjät voi käyttää
* näyttää käyttäjille vain omat palvelut
* admineille näytetään kaikkien palvelut
* insertoidessa customer_id on defaulttina käyttäjän customer_id
** vain admin voi käyttää jotain muuta customer_id:tä

* t_vhosts_id  Vhostin unikki id
* t_customers_id Jäsenen id, pakollinen kenttä
* username  käyttäjän nimi, pakollinen kenttä
* t_users_id käyttäjän id
* created tieto millon vhost on luotu ( vain luku ) 
* name vhostin koko osoite
* aliases vhostin mahdolliset aliakset
* redirects osoitteet, mitkä edelleenohjataan tähän vhostiin
* redirect_to vhost on edelleenohjaus tähän osoitteeseen
* logaccess onko käyttäjällä oikeus lukea access.log:ia, vain admin voi muuttaa
* locked onko vhost lukossa, vain admin voi muuttaa
* t_domains_id domainin id ( vain luku ) 
* t_services_id vhostia palvelevan palvelimen t_services_id
* disabled Vhosti poissa käytöstä


=== user_ports ===
* Viewi, missä käyttäjä näkee omat porttinsa.
* Adminille näkyy kaikkien käyttäjien portit.
* customers_id oletuksena käyttäjän oma
* Portti arvotaan public.find_free_port(services_id) funktiolla seuraavaksi vapaaksi portiksi

=== customers ===
* View sisältää tiedon asiakkaasta ja tämän aliaksista
* ks. t_customers

=== services.change_log === 
* View, joka on vähän laajennettu näkymä t_change_log:sta
* Tarkoitettu renkisrv:n käyttöön.

